<!DOCTYPE html>
<html lang="en">
<head>
    <title>UIPTV Web - MyFlix View</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0b0b0b">
    <link rel="icon" type="image/x-icon" href="/icon.ico">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/myflix.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@5/dist/shaka-player.compiled.js"></script>
</head>
<body>
<div id="app" class="myflix-app">
    <header class="nf-topbar">
        <div class="nf-brand" @click="resetApp" title="Home">
            <img src="/icon.ico" alt="UIPTV">
            <span>UIPTV</span>
        </div>
        <div class="nf-actions">
            <div class="nf-search nf-search-top">
                <i class="bi bi-search"></i>
                <input type="text" v-model="searchQuery" placeholder="Search..." id="searchInput">
            </div>
            <button class="nf-action-btn" @click="toggleTheme" :title="'Theme: ' + theme">
                <i class="bi" :class="themeIcon"></i>
            </button>
            <button class="nf-action-btn" @click="clearWebCacheAndReload" title="Clear cache and reload">
                <i class="bi bi-arrow-repeat"></i>
            </button>
            <button class="nf-action-btn" @click="showBookmarkModal = true" title="Bookmark this app">
                <i class="bi bi-bookmark-plus"></i>
            </button>
            <a href="https://github.com/xixogo5105/uiptv" target="_blank" class="nf-action-btn" title="Help">
                <i class="bi bi-question-circle"></i>
            </a>
            <a href="/bookmarks.m3u8" class="nf-action-btn" title="Download Favorites Playlist" download>
                <i class="bi bi-download"></i>
            </a>
            <a href="/iptv.m3u8" class="nf-action-btn" title="Download Published Playlist" download>
                <i class="bi bi-cloud-arrow-down"></i>
            </a>
            <a href="/index.html" class="nf-action-btn" title="Switch to Classic View">
                <i class="bi bi-grid-3x3-gap-fill"></i>
            </a>
        </div>
    </header>

    <main class="nf-main" :class="{ 'detail-mode': isDetailPageOpen, 'series-detail-mode': isSeriesDetailOpen }">
        <section class="nf-library">
            <template v-if="!isDetailPageOpen">
            <div class="nf-row nf-row-pinned">
                <div class="nf-row-title">
                    <h5 class="nf-section-title"><span>Favorites</span></h5>
                    <div class="nf-bookmark-tabs" role="tablist" aria-label="Favorite categories">
                        <button
                                v-for="category in bookmarkCategoryTabs"
                                :key="'myflix-bookmark-category-' + (category.id || 'all')"
                                class="nf-bookmark-tab"
                                :class="{ active: String(selectedBookmarkCategoryId || '') === String(category.id || '') }"
                                @click="selectBookmarkCategory(category.id)">
                            {{ category.name }}
                        </button>
                    </div>
                </div>
                <div class="nf-track-wrap">
                    <button class="nf-edge-btn left" onclick="scrollRow('row-saved', -1)" type="button"><i class="bi bi-chevron-left"></i></button>
                    <div class="nf-strip" id="row-saved">
                        <button v-for="bookmark in filteredBookmarks" :key="'saved-server-' + bookmark.dbId" class="nf-card nf-card-media" @click="playBookmark(bookmark)">
                            <img v-if="bookmark.logo" class="nf-media-image" :src="bookmark.logo" @error="mediaImageError" alt="bookmark image">
                            <div class="nf-media-fallback" :class="{ show: !bookmark.logo }">
                                {{ bookmark.channelName }}
                            </div>
                            <div class="nf-media-gradient"></div>
                            <div class="nf-card-title nf-media-title">{{ bookmark.channelName }}</div>
                            <div class="nf-card-subtitle nf-media-subtitle"><small>{{ bookmark.accountName }}</small></div>
                        </button>
                        <div v-if="isModeLoading('bookmarks')" class="nf-empty-card">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Loading favorites...
                        </div>
                        <div v-else-if="filteredBookmarks.length === 0" class="nf-empty-card">No favorites found.</div>
                    </div>
                    <button class="nf-edge-btn right" onclick="scrollRow('row-saved', 1)" type="button"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            <div class="nf-row nf-row-shell">
                <div class="nf-row-title">
                    <div class="nf-bookmark-tabs nf-account-type-tabs" role="tablist" aria-label="Account types">
                        <button class="nf-bookmark-tab" :class="{ active: selectedAccountTypeFilter === 'all' }" @click="selectAccountTypeFilter('all')">All</button>
                        <button class="nf-bookmark-tab" :class="{ active: selectedAccountTypeFilter === 'stalker' }" @click="selectAccountTypeFilter('stalker')">Stalker Portal</button>
                        <button class="nf-bookmark-tab" :class="{ active: selectedAccountTypeFilter === 'xtreme' }" @click="selectAccountTypeFilter('xtreme')">Xtreme</button>
                        <button class="nf-bookmark-tab" :class="{ active: selectedAccountTypeFilter === 'm3u' }" @click="selectAccountTypeFilter('m3u')">M3u</button>
                        <button class="nf-bookmark-tab" :class="{ active: selectedAccountTypeFilter === 'rss' }" @click="selectAccountTypeFilter('rss')">RSS</button>
                    </div>
                </div>
                <div class="nf-track-wrap">
                    <button class="nf-edge-btn left" onclick="scrollRow('row-accounts', -1)" type="button"><i class="bi bi-chevron-left"></i></button>
                    <div class="nf-strip" id="row-accounts">
                        <button
                                v-for="account in filteredAccounts"
                                :key="'myflix-account-' + account.dbId"
                                class="nf-card nf-card-title-only"
                                :class="{ active: String(selectedAccountId || '') === String(account.dbId || '') }"
                                @click="selectAccount(account)">
                            <div class="nf-card-icon"><i class="bi bi-person-circle"></i></div>
                            <div class="nf-card-title">{{ account.accountName }}</div>
                            <div class="nf-card-subtitle">{{ account.type }}</div>
                        </button>
                        <div v-if="filteredAccounts.length === 0" class="nf-empty-card">No accounts for this filter.</div>
                    </div>
                    <button class="nf-edge-btn right" onclick="scrollRow('row-accounts', 1)" type="button"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            <div v-if="selectedAccount" class="nf-row nf-row-shell">
                <div class="nf-row-title">
                    <div class="nf-title-with-back">
                        <button class="nf-title-back" :class="{ ghost: isModeState('itv', 'categories') }" @click="!isModeState('itv', 'categories') && goBackMode('itv')" title="Back" :aria-disabled="isModeState('itv', 'categories') ? 'true' : 'false'">
                            <i class="bi bi-arrow-left-circle"></i>
                        </button>
                        <h5 class="nf-section-title"><span>Live TV</span></h5>
                    </div>
                </div>
                <div class="nf-track-wrap">
                    <button class="nf-edge-btn left" onclick="scrollRow('row-live', -1)" type="button"><i class="bi bi-chevron-left"></i></button>
                    <div class="nf-strip" id="row-live">
                        <button v-if="isModeState('itv','categories')" v-for="category in filteredModeCategories('itv')" :key="'itv-cat-' + category.dbId" class="nf-card" @click="loadModeChannels('itv', category.dbId)">
                            <div class="nf-card-icon"><i class="bi bi-folder-fill"></i></div>
                            <div class="nf-card-title">{{ category.title }}</div>
                        </button>
                        <button v-if="isModeState('itv','channels')" v-for="channel in visibleModeChannels('itv')" :key="'itv-ch-' + (channel.dbId || channel.channelId || channel.id)" class="nf-card nf-card-media" @click="handleModeSelection('itv', channel)">
                            <img v-if="channel.logo" class="nf-media-image" :src="channel.logo" loading="lazy" @error="mediaImageError" alt="channel image">
                            <div class="nf-media-fallback" :class="{ show: !channel.logo }">{{ channel.name }}</div>
                            <div class="nf-media-gradient"></div>
                            <div class="nf-card-title nf-media-title">{{ channel.name }}</div>
                        </button>
                        <button v-if="isModeState('itv','channels') && hasMoreModeChannels('itv')" class="nf-card nf-load-more-card" @click="loadMoreModeChannels('itv')">
                            <div class="nf-card-icon"><i class="bi bi-chevron-down"></i></div>
                            <div class="nf-card-title">Load More</div>
                        </button>
                        <div v-if="isModeLoading('itv')" class="nf-empty-card">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Loading...
                        </div>
                        <div v-else-if="isModeState('itv','categories') && filteredModeCategories('itv').length === 0" class="nf-empty-card">No categories found.</div>
                        <div v-else-if="isModeState('itv','channels') && filteredModeChannels('itv').length === 0" class="nf-empty-card">No channels found.</div>
                    </div>
                    <button class="nf-edge-btn right" onclick="scrollRow('row-live', 1)" type="button"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            <div v-if="showVodSeriesSections" class="nf-row nf-row-shell">
                <div class="nf-row-title">
                    <div class="nf-title-with-back">
                        <button class="nf-title-back" :class="{ ghost: isModeState('vod', 'categories') }" @click="!isModeState('vod', 'categories') && goBackMode('vod')" title="Back" :aria-disabled="isModeState('vod', 'categories') ? 'true' : 'false'">
                            <i class="bi bi-arrow-left-circle"></i>
                        </button>
                        <h5 class="nf-section-title"><span>Movies</span></h5>
                    </div>
                </div>
                <div class="nf-track-wrap">
                    <button class="nf-edge-btn left" onclick="scrollRow('row-vod', -1)" type="button"><i class="bi bi-chevron-left"></i></button>
                    <div class="nf-strip" id="row-vod">
                        <button v-if="isModeState('vod','categories')" v-for="category in filteredModeCategories('vod')" :key="'vod-cat-' + category.dbId" class="nf-card" @click="loadModeChannels('vod', category.dbId)">
                            <div class="nf-card-icon"><i class="bi bi-folder-fill"></i></div>
                            <div class="nf-card-title">{{ category.title }}</div>
                        </button>
                        <button v-if="isModeState('vod','channels')" v-for="channel in visibleModeChannels('vod')" :key="'vod-ch-' + (channel.dbId || channel.channelId || channel.id)" class="nf-card nf-card-media" @click="handleModeSelection('vod', channel)">
                            <img v-if="channel.logo" class="nf-media-image" :src="channel.logo" loading="lazy" @error="mediaImageError" alt="vod image">
                            <div class="nf-media-fallback" :class="{ show: !channel.logo }">{{ channel.name }}</div>
                            <div class="nf-media-gradient"></div>
                            <div class="nf-card-title nf-media-title">{{ channel.name }}</div>
                        </button>
                        <button v-if="isModeState('vod','channels') && hasMoreModeChannels('vod')" class="nf-card nf-load-more-card" @click="loadMoreModeChannels('vod')">
                            <div class="nf-card-icon"><i class="bi bi-chevron-down"></i></div>
                            <div class="nf-card-title">Load More</div>
                        </button>
                        <div v-if="isModeLoading('vod')" class="nf-empty-card">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Loading...
                        </div>
                        <div v-else-if="isModeState('vod','categories') && filteredModeCategories('vod').length === 0" class="nf-empty-card">No categories found.</div>
                        <div v-else-if="isModeState('vod','channels') && filteredModeChannels('vod').length === 0" class="nf-empty-card">No VOD items found.</div>
                    </div>
                    <button class="nf-edge-btn right" onclick="scrollRow('row-vod', 1)" type="button"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            <div v-if="showVodSeriesSections" class="nf-row nf-row-shell">
                <div class="nf-row-title">
                    <div class="nf-title-with-back">
                        <button class="nf-title-back" :class="{ ghost: isModeState('series', 'categories') }" @click="!isModeState('series', 'categories') && goBackMode('series')" title="Back" :aria-disabled="isModeState('series', 'categories') ? 'true' : 'false'">
                            <i class="bi bi-arrow-left-circle"></i>
                        </button>
                        <h5 class="nf-section-title"><span>Series</span></h5>
                    </div>
                </div>
                <div class="nf-track-wrap">
                    <button class="nf-edge-btn left" onclick="scrollRow('row-series', -1)" type="button"><i class="bi bi-chevron-left"></i></button>
                    <div class="nf-strip" id="row-series">
                        <button v-if="isModeState('series','categories')" v-for="category in filteredModeCategories('series')" :key="'series-cat-' + category.dbId" class="nf-card" @click="loadModeChannels('series', category.dbId)">
                            <div class="nf-card-icon"><i class="bi bi-folder-fill"></i></div>
                            <div class="nf-card-title">{{ category.title }}</div>
                        </button>
                        <button v-if="isModeState('series','channels')" v-for="channel in visibleModeChannels('series')" :key="'series-ch-' + (channel.dbId || channel.channelId || channel.id)" class="nf-card nf-card-media" @click="handleModeSelection('series', channel)">
                            <img v-if="channel.logo" class="nf-media-image" :src="channel.logo" loading="lazy" @error="mediaImageError" alt="series image">
                            <div class="nf-media-fallback" :class="{ show: !channel.logo }">{{ channel.name }}</div>
                            <div class="nf-media-gradient"></div>
                            <div class="nf-card-title nf-media-title">{{ channel.name }}</div>
                        </button>
                        <button v-if="isModeState('series','channels') && hasMoreModeChannels('series')" class="nf-card nf-load-more-card" @click="loadMoreModeChannels('series')">
                            <div class="nf-card-icon"><i class="bi bi-chevron-down"></i></div>
                            <div class="nf-card-title">Load More</div>
                        </button>
                        <button v-if="isModeState('series','episodes')" v-for="episode in visibleModeEpisodes('series')" :key="'series-ep-' + (episode.channelId || episode.id)" class="nf-card nf-card-media" @click="handleModeSelection('series', episode)">
                            <img v-if="episode.logo" class="nf-media-image" :src="episode.logo" loading="lazy" @error="mediaImageError" alt="episode image">
                            <div class="nf-media-fallback" :class="{ show: !episode.logo }">{{ episode.name }}</div>
                            <div class="nf-media-gradient"></div>
                            <div class="nf-card-title nf-media-title">{{ episode.name }}</div>
                        </button>
                        <button v-if="isModeState('series','episodes') && hasMoreModeEpisodes('series')" class="nf-card nf-load-more-card" @click="loadMoreModeEpisodes('series')">
                            <div class="nf-card-icon"><i class="bi bi-chevron-down"></i></div>
                            <div class="nf-card-title">Load More</div>
                        </button>
                        <div v-if="isModeLoading('series')" class="nf-empty-card">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Loading...
                        </div>
                        <div v-else-if="isModeState('series','categories') && filteredModeCategories('series').length === 0" class="nf-empty-card">No categories found.</div>
                        <div v-else-if="isModeState('series','channels') && filteredModeChannels('series').length === 0" class="nf-empty-card">No series found.</div>
                        <div v-else-if="isModeState('series','episodes') && filteredModeEpisodes('series').length === 0" class="nf-empty-card">No episodes found.</div>
                    </div>
                    <button class="nf-edge-btn right" onclick="scrollRow('row-series', 1)" type="button"><i class="bi bi-chevron-right"></i></button>
                </div>
            </div>

            </template>

            <template v-if="isVodDetailOpen">
            <div class="nf-row">
                <div class="nf-row-title">
                    <div class="nf-title-with-back">
                        <button class="nf-title-back" @click="goBackMode('vod')" title="Back">
                            <i class="bi bi-arrow-left-circle"></i>
                        </button>
                        <h5 class="nf-section-title"><span>{{ getVodDetail() ? (getVodDetail().name || 'Movies') : 'Movies' }}</span></h5>
                    </div>
                </div>
                <div class="nf-series-page">
                    <div class="nf-series-hero">
                        <div class="nf-series-poster-wrap">
                            <img v-if="getVodDetail() && getVodDetail().cover" class="nf-series-poster" :src="getVodDetail().cover" @error="mediaImageError" alt="vod poster">
                            <div v-else class="nf-series-poster-fallback">No Poster</div>
                        </div>
                        <div class="nf-series-meta">
                            <p v-if="getVodDetail() && getVodDetail().plot">{{ getVodDetail().plot }}</p>
                            <a
                                    v-if="getImdbUrl('vod')"
                                    class="nf-imdb-rating-pill"
                                    :href="getImdbUrl('vod')"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    title="Open on IMDb">
                                <img class="nf-imdb-logo" src="https://upload.wikimedia.org/wikipedia/commons/6/69/IMDB_Logo_2016.svg" alt="IMDb">
                                <span class="nf-imdb-rating-value">{{ getVodDetail() ? (getVodDetail().rating || 'N/A') : 'N/A' }}</span>
                            </a>
                            <div class="nf-meta-grid">
                                <div><strong>Genre:</strong> {{ getVodDetail() ? (getVodDetail().genre || 'N/A') : 'N/A' }}</div>
                                <div><strong>Release:</strong> {{ getVodDetail() ? (getVodDetail().releaseDate || 'N/A') : 'N/A' }}</div>
                                <div><strong>Director:</strong> {{ getVodDetail() ? (getVodDetail().director || 'N/A') : 'N/A' }}</div>
                                <div><strong>Cast:</strong> {{ getVodDetail() ? (getVodDetail().cast || 'N/A') : 'N/A' }}</div>
                            </div>
                            <button class="nf-vod-play-btn" @click="playVodFromDetail">
                                <i class="bi bi-play-circle-fill"></i>
                                Play Video
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </template>

            <template v-if="isSeriesDetailOpen">
            <div class="nf-row">
                <div class="nf-row-title">
                    <div class="nf-title-with-back">
                        <button class="nf-title-back" @click="goBackMode('series')" title="Back">
                            <i class="bi bi-arrow-left-circle"></i>
                        </button>
                        <h5 class="nf-section-title"><span>{{ getSeriesDetail() ? (getSeriesDetail().name || 'Series') : 'Series' }}</span></h5>
                    </div>
                </div>
                <div class="nf-series-page">
                    <div class="nf-series-hero">
                        <div class="nf-series-poster-wrap">
                            <img v-if="getSeriesDetail() && getSeriesDetail().cover" class="nf-series-poster" :src="getSeriesDetail().cover" @error="mediaImageError" alt="series poster">
                            <div v-else class="nf-series-poster-fallback">No Poster</div>
                        </div>
                        <div class="nf-series-meta">
                            <p v-if="getSeriesDetail() && getSeriesDetail().plot">{{ getSeriesDetail().plot }}</p>
                            <a
                                    v-if="getImdbUrl()"
                                    class="nf-imdb-rating-pill"
                                    :href="getImdbUrl()"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    title="Open on IMDb">
                                <img class="nf-imdb-logo" src="https://upload.wikimedia.org/wikipedia/commons/6/69/IMDB_Logo_2016.svg" alt="IMDb">
                                <span class="nf-imdb-rating-value">{{ getSeriesDetail() ? (getSeriesDetail().rating || 'N/A') : 'N/A' }}</span>
                            </a>
                            <div class="nf-meta-grid">
                                <div><strong>Genre:</strong> {{ getSeriesDetail() ? (getSeriesDetail().genre || 'N/A') : 'N/A' }}</div>
                                <div><strong>Release:</strong> {{ getSeriesDetail() ? (getSeriesDetail().releaseDate || 'N/A') : 'N/A' }}</div>
                                <div><strong>Director:</strong> {{ getSeriesDetail() ? (getSeriesDetail().director || 'N/A') : 'N/A' }}</div>
                                <div><strong>Cast:</strong> {{ getSeriesDetail() ? (getSeriesDetail().cast || 'N/A') : 'N/A' }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="nf-row-title mt-3 mb-2">
                        <h6 class="nf-episodes-title">Episodes</h6>
                    </div>
                    <div v-if="seriesSeasonTabs.length > 0" class="nf-season-tabs">
                        <button
                                v-for="tab in seriesSeasonTabs"
                                :key="'season-tab-' + tab.value"
                                class="nf-season-tab"
                                :class="{ active: selectedSeriesSeason === tab.value }"
                                @click="selectSeriesSeason(tab.value)">
                            {{ tab.label }}
                        </button>
                    </div>
                    <div class="nf-episode-list">
                        <div v-if="isModeLoading('series')" class="nf-empty-card">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Loading episodes...
                        </div>
                        <button
                                v-for="(episode, idx) in visibleSeriesDetailEpisodes"
                                :key="'series-detail-ep-' + (episode.channelId || episode.id)"
                                class="nf-episode-row"
                                @click="handleModeSelection('series', episode)">
                            <div class="nf-episode-index">{{ idx + 1 }}</div>
                            <div class="nf-episode-thumb-wrap">
                                <img v-if="episode.logo" class="nf-episode-thumb" :src="episode.logo" @error="mediaImageError" alt="episode image">
                                <div class="nf-episode-thumb-fallback" :class="{ show: !episode.logo }">{{ episode.name }}</div>
                            </div>
                            <div class="nf-episode-main">
                                <div class="nf-episode-title">{{ getEpisodeDisplayTitle(episode, idx) }}</div>
                                <div class="nf-episode-sub">
                                    {{ episode.description || (episode.releaseDate ? ('Release: ' + episode.releaseDate) : (episode.channelId ? ('ID ' + episode.channelId) : 'Tap to play')) }}
                                </div>
                            </div>
                            <div class="nf-episode-play">
                                <i class="bi bi-play-circle-fill"></i>
                            </div>
                        </button>
                        <button v-if="hasMoreSeriesDetailEpisodes" class="nf-episode-load-more" @click="loadMoreSeriesDetailEpisodes">
                            Load more episodes
                        </button>
                        <div v-if="filteredSeriesDetailEpisodes.length === 0" class="nf-empty-card">No episodes found in this season.</div>
                    </div>
                </div>
            </div>
            </template>
        </section>
    </main>

    <div v-if="isBusy && !isPlaying" class="nf-loading-overlay" role="status" aria-live="polite" aria-label="Loading">
        <div class="nf-loading-box">
            <div class="spinner-border text-light" role="status"></div>
            <div class="nf-loading-text">{{ busyMessage }}</div>
        </div>
    </div>

    <div v-if="isPlaying" class="nf-player-popup" @click.self="closePlayerPopup">
        <div class="nf-player-popup-frame" ref="playerModalFrame" @mouseenter="showOverlay = true" @mouseleave="showOverlay = false">
            <button class="nf-player-close" @click="closePlayerPopup" title="Close">
                <i class="bi bi-x-lg"></i>
            </button>
            <div class="nf-player-top" :style="{ opacity: showOverlay ? 1 : 0 }">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <h4 class="nf-player-title">{{ currentChannelName || 'Now Playing' }}</h4>
                    <div class="d-flex align-items-center nf-player-controls">
                        <button class="btn btn-link text-white me-2" @click="onPlayerControlClick($event, toggleFavorite)" title="Favorite">
                            <i class="bi" :class="isCurrentFavorite ? 'bi-heart-fill text-danger' : 'bi-heart'"></i>
                        </button>
                        <button class="btn btn-link text-white me-2" @click="onPlayerControlClick($event, reloadPlayback)" title="Reload">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-link text-white me-2" @click="onPlayerControlClick($event, toggleRepeat)" title="Repeat playback">
                            <i class="bi" :class="repeatEnabled ? 'bi-repeat-1 text-warning' : 'bi-repeat'"></i>
                        </button>
                        <button class="btn btn-link text-white me-2" @click="onPlayerControlClick($event, togglePictureInPicture)" title="Picture in Picture">
                            <i class="bi bi-pip"></i>
                        </button>
                        <div class="dropdown d-inline-block" v-if="videoTracks && videoTracks.length">
                            <button class="btn btn-link text-white me-2" type="button" id="resolutionMenuButtonPopup" data-bs-toggle="dropdown" aria-expanded="false" title="Resolutions">
                                <i class="bi bi-gear-fill"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="resolutionMenuButtonPopup">
                                <li v-for="track in videoTracks" :key="track.id">
                                    <a class="dropdown-item" href="#" @click="onPlayerControlClick($event, switchVideoTrack, track.id)">
                                        {{ track.height }}p
                                        <span v-if="track.active" class="badge bg-primary ms-2">Active</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <button class="btn btn-link text-white" @click="stopPlayback" title="Stop">
                            <i class="bi bi-stop-circle-fill fs-4"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="nf-player-media">
                <video
                        v-if="!isYoutube"
                        :key="playerKey"
                        ref="videoPlayerModal"
                        class="nf-video"
                        controls
                        autoplay
                ></video>

                <iframe
                        v-if="isYoutube"
                        :src="youtubeSrc"
                        frameborder="0"
                        allowfullscreen
                        allow="autoplay; encrypted-media"
                        class="nf-video"
                ></iframe>
            </div>
        </div>
    </div>

    <div v-if="showBookmarkModal" class="modal-backdrop fade show"></div>
    <div v-if="showBookmarkModal" class="modal fade show d-block" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-light border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">How to Bookmark App</h5>
                    <button type="button" class="btn-close btn-close-white" @click="showBookmarkModal = false"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Chrome (Desktop):</strong> Press Ctrl+D (Cmd+D on Mac).</p>
                    <p><strong>Chrome (Android):</strong> Menu (three dots) > Add to Home screen.</p>
                    <p><strong>Safari (iOS):</strong> Share > Add to Home Screen.</p>
                    <p><strong>Safari (Mac):</strong> Press Cmd+D.</p>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" @click="showBookmarkModal = false">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="javascript/myflix.js"></script>
<script>
    function scrollRow(id, direction) {
        const row = document.getElementById(id);
        if (!row) return;
        const amount = Math.max(240, Math.floor(row.clientWidth * 0.75));
        row.scrollBy({ left: amount * direction, behavior: 'smooth' });
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }
</script>
</body>
</html>
